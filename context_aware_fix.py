# context_aware_fix.py
# æ–‡è„ˆã‚’ç†è§£ã™ã‚‹æ©Ÿèƒ½ã‚’è¿½åŠ 

import re

def update_analyze_function_with_context():
    """analyze_message_improvedé–¢æ•°ã«æ–‡è„ˆç†è§£æ©Ÿèƒ½ã‚’è¿½åŠ """
    
    try:
        with open('advisor/views.py', 'r', encoding='utf-8') as f:
            content = f.read()
        
        # æ–‡è„ˆç†è§£æ©Ÿèƒ½ä»˜ãã®æ–°ã—ã„é–¢æ•°
        new_function = '''def analyze_message_improved(message, user_context=None):
    """æ”¹è‰¯ã•ã‚ŒãŸç›´æ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è§£æ - æ–‡è„ˆç†è§£æ©Ÿèƒ½ä»˜ã"""
    message_lower = message.lower()
    
    print("ğŸ” ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è§£æ:", message)
    
    # æ–‡è„ˆã‚’è€ƒæ…®ã—ãŸè³ªå•è§£æ
    # ã€Œç”³è«‹æ–¹æ³•ã€ã€Œã‚„ã‚Šæ–¹ã€ã€Œæ‰‹é †ã€ã ã‘ã®å ´åˆã¯ã€ç›´å‰ã®è£œåŠ©é‡‘ã‚’æ¨æ¸¬
    is_follow_up_question = any(keyword in message_lower for keyword in ['ç”³è«‹æ–¹æ³•', 'ç”³è«‹æ‰‹é †', 'ã‚„ã‚Šæ–¹', 'æ‰‹ç¶šã', 'ç”³è«‹']) and len(message.split()) <= 3
    
    if is_follow_up_question:
        print("âœ… ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—è³ªå•ã¨ã—ã¦æ¤œå‡º")
        # æœ€è¿‘è¨€åŠã•ã‚ŒãŸè£œåŠ©é‡‘ã‚’æ¨æ¸¬ï¼ˆç°¡æ˜“ç‰ˆï¼‰
        if any(keyword in message_lower for keyword in ['ç”³è«‹æ–¹æ³•', 'ç”³è«‹æ‰‹é †', 'ã‚„ã‚Šæ–¹', 'ç”³è«‹']):
            return {
                'answer': """## ğŸ“‹ å…·ä½“çš„ãªç”³è«‹æ–¹æ³•ã«ã¤ã„ã¦

ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€‚ã‚ˆã‚Šæ­£ç¢ºã«ãŠç­”ãˆã™ã‚‹ãŸã‚ã€ã©ã¡ã‚‰ã®è£œåŠ©é‡‘ã®ç”³è«‹æ–¹æ³•ã‚’ãŠçŸ¥ã‚Šã«ãªã‚ŠãŸã„ã‹æ•™ãˆã¦ãã ã•ã„ï¼š

### ğŸ¯ ä¸»è¦ãªè£œåŠ©é‡‘åˆ¶åº¦

#### ğŸ–¥ï¸ **ã€ŒITå°å…¥è£œåŠ©é‡‘ã®ç”³è«‹æ–¹æ³•ã‚’æ•™ãˆã¦ã€**
- gBizIDå–å¾—ã€SECURITY ACTIONå®Ÿæ–½
- ITå°å…¥æ”¯æ´äº‹æ¥­è€…ã¨ã®é€£æº
- è©³ç´°ãªæ‰‹é †ã‚’ã”èª¬æ˜ã—ã¾ã™

#### ğŸ­ **ã€Œã‚‚ã®ã¥ãã‚Šè£œåŠ©é‡‘ã®ç”³è«‹æ–¹æ³•ã‚’æ•™ãˆã¦ã€**
- é©æ–°æ€§ã®è¨¼æ˜ã€äº‹æ¥­è¨ˆç”»ç­–å®š
- èªå®šæ”¯æ´æ©Ÿé–¢ã¨ã®é€£æº
- è©³ç´°ãªæ‰‹é †ã‚’ã”èª¬æ˜ã—ã¾ã™

#### ğŸ¢ **ã€Œå°è¦æ¨¡äº‹æ¥­è€…æŒç¶šåŒ–è£œåŠ©é‡‘ã®ç”³è«‹æ–¹æ³•ã‚’æ•™ãˆã¦ã€**
- å•†å·¥ä¼šè­°æ‰€ã¨ã®é€£æº
- çµŒå–¶è¨ˆç”»æ›¸ã®ç­–å®š
- è©³ç´°ãªæ‰‹é †ã‚’ã”èª¬æ˜ã—ã¾ã™

#### ğŸ¤– **ã€ŒçœåŠ›åŒ–æŠ•è³‡è£œåŠ©é‡‘ã®ç”³è«‹æ–¹æ³•ã‚’æ•™ãˆã¦ã€**
- çœåŠ›åŒ–è£½å“ã®é¸å®š
- åŠ¹æœæ¸¬å®šè¨ˆç”»ã®ç­–å®š
- è©³ç´°ãªæ‰‹é †ã‚’ã”èª¬æ˜ã—ã¾ã™

### ğŸ’¡ ã‚ˆã‚Šå…·ä½“çš„ã«

ä¸Šè¨˜ã®ã‚ˆã†ã« **ã€Œâ—‹â—‹è£œåŠ©é‡‘ã®ç”³è«‹æ–¹æ³•ã‚’æ•™ãˆã¦ã€** ã¨å…·ä½“çš„ã«ãŠèãã„ãŸã ã‘ã‚Œã°ã€ãã®è£œåŠ©é‡‘ã«ç‰¹åŒ–ã—ãŸè©³ç´°ãªç”³è«‹æ‰‹é †ã‚’ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã§ã”èª¬æ˜ã„ãŸã—ã¾ã™ï¼

ã©ã¡ã‚‰ã®è£œåŠ©é‡‘ã«ã¤ã„ã¦ãŠçŸ¥ã‚Šã«ãªã‚ŠãŸã„ã§ã™ã‹ï¼Ÿ""",
                'confidence_score': 0.8,
                'model_used': 'context-aware-followup',
                'recommended_subsidies': []
            }
    
    # ã‚‚ã®ã¥ãã‚Šè£œåŠ©é‡‘ã®æ¤œå‡º
    if any(keyword in message_lower for keyword in ['ã‚‚ã®ã¥ãã‚Š', 'monozukuri', 'è¨­å‚™æŠ•è³‡', 'ã‚‚ã®ã¥ãã‚Šè£œåŠ©é‡‘']):
        print("âœ… ã‚‚ã®ã¥ãã‚Šè£œåŠ©é‡‘ã¨ã—ã¦æ¤œå‡º")
        
        if any(keyword in message_lower for keyword in ['ç”³è«‹æ–¹æ³•', 'ç”³è«‹æ‰‹é †', 'ã‚„ã‚Šæ–¹', 'ç”³è«‹']):
            return {
                'answer': """## ğŸ­ ã‚‚ã®ã¥ãã‚Šè£œåŠ©é‡‘ã®ç”³è«‹æ–¹æ³•

ã‚‚ã®ã¥ãã‚Šè£œåŠ©é‡‘ã®ç”³è«‹æ‰‹é †ã‚’è©³ã—ãã”èª¬æ˜ã„ãŸã—ã¾ã™ã€‚

### ğŸ“‹ åŸºæœ¬æƒ…å ±
- **æ­£å¼åç§°**: ã‚‚ã®ã¥ãã‚Šãƒ»å•†æ¥­ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ç”Ÿç”£æ€§å‘ä¸Šä¿ƒé€²è£œåŠ©é‡‘
- **è£œåŠ©ä¸Šé™é¡**: 1,250ä¸‡å††ï¼ˆãƒ‡ã‚¸ã‚¿ãƒ«æ ï¼‰
- **è£œåŠ©ç‡**: 1/2ä»¥å†…ï¼ˆå°è¦æ¨¡äº‹æ¥­è€…ã¯2/3ï¼‰
- **ç”³è«‹æ™‚æœŸ**: å¹´2-3å›ã®å…¬å‹Ÿ

### ğŸ“… è©³ç´°ãªç”³è«‹æ‰‹é †

#### **STEP 1: äº‹å‰æº–å‚™ï¼ˆç”³è«‹ã®2-3ãƒ¶æœˆå‰ï¼‰**

1. **å…¬å‹Ÿè¦é ˜ã®ç¢ºèª**
   - æœ€æ–°ç‰ˆã®å…¬å‹Ÿè¦é ˜ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
   - å¯¾è±¡è¦ä»¶ãƒ»å¯¾è±¡çµŒè²»ã‚’è©³ç´°ç¢ºèª
   - å¯©æŸ»é …ç›®ã®æŠŠæ¡

2. **åŸºæœ¬è¦ä»¶ã®ç¢ºèª**
   - ä¸­å°ä¼æ¥­ãƒ»å°è¦æ¨¡äº‹æ¥­è€…ã®è©²å½“ç¢ºèª
   - 3å¹´é–“ã®äº‹æ¥­ç¶™ç¶šæ„æ€
   - ä»˜åŠ ä¾¡å€¤é¡å¹´ç‡å¹³å‡3%ä»¥ä¸Šå‘ä¸Šè¨ˆç”»

3. **å¿…è¦æ›¸é¡ã®æº–å‚™**
   - æ±ºç®—æ›¸ï¼ˆç›´è¿‘3æœŸåˆ†ï¼‰
   - ç¢ºå®šç”³å‘Šæ›¸
   - å±¥æ­´äº‹é …å…¨éƒ¨è¨¼æ˜æ›¸

#### **STEP 2: è¨ˆç”»ç­–å®šï¼ˆç”³è«‹ã®1-2ãƒ¶æœˆå‰ï¼‰**

1. **äº‹æ¥­è¨ˆç”»æ›¸ã®ä½œæˆ**
   - ç¾çŠ¶ã®èª²é¡Œåˆ†æ
   - å°å…¥è¨­å‚™ãƒ»ã‚·ã‚¹ãƒ†ãƒ ã®è©³ç´°
   - é©æ–°æ€§ãƒ»ç‹¬è‡ªæ€§ã®èª¬æ˜
   - ä»˜åŠ ä¾¡å€¤é¡å‘ä¸Šã®æ ¹æ‹ 

2. **è¦‹ç©æ›¸ã®å–å¾—**
   - è¤‡æ•°æ¥­è€…ã‹ã‚‰ã®ç›¸è¦‹ç©ã‚‚ã‚Š
   - è¨­å‚™ä»•æ§˜æ›¸ã®åé›†
   - ä¾¡æ ¼ã®å¦¥å½“æ€§ç¢ºèª

#### **STEP 3: ç”³è«‹æ›¸ä½œæˆ**

1. **æ§˜å¼è¨˜å…¥**
   - æ§˜å¼1ï¼šäº‹æ¥­è¨ˆç”»æ›¸
   - æ§˜å¼2ï¼šçµŒè²»æ˜ç´°æ›¸
   - æ§˜å¼3ï¼šè³‡é‡‘èª¿é”å†…è¨³æ›¸

2. **æ·»ä»˜æ›¸é¡ã®æº–å‚™**
   - ä¼šç¤¾æ¡ˆå†…ãƒ»è£½å“ã‚«ã‚¿ãƒ­ã‚°
   - å·¥å ´ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå›³
   - æŠ€è¡“è³‡æ–™

#### **STEP 4: ç”³è«‹ãƒ»å¯©æŸ»**

1. **é›»å­ç”³è«‹**
   - Jã‚°ãƒ©ãƒ³ãƒ„ã§ã®æå‡º
   - æœŸé™å³å®ˆï¼ˆç· åˆ‡æ—¥17:00ã¾ã§ï¼‰

2. **å¯©æŸ»æœŸé–“**
   - æ›¸é¢å¯©æŸ»ï¼ˆé€šå¸¸2-3ãƒ¶æœˆï¼‰
   - å¯©æŸ»é …ç›®ï¼šæŠ€è¡“é¢ã€äº‹æ¥­åŒ–é¢ã€æ”¿ç­–é¢

3. **çµæœé€šçŸ¥**
   - æ¡æŠãƒ»ä¸æ¡æŠã®é€£çµ¡

### âš ï¸ ç”³è«‹æ™‚ã®é‡è¦ãƒã‚¤ãƒ³ãƒˆ

#### **é©æ–°æ€§ã®æ˜ç¢ºåŒ–**
- å¾“æ¥æŠ€è¡“ã¨ã®é•ã„ã‚’å…·ä½“çš„ã«èª¬æ˜
- æ–°è¦æ€§ãƒ»å„ªä½æ€§ã‚’æ•°å€¤ã§è¡¨ç¾
- ç‰¹è¨±ãƒ»ãƒã‚¦ãƒã‚¦ã®æ´»ç”¨

#### **äº‹æ¥­æ€§ã®èª¬æ˜**
- å¸‚å ´ãƒ‹ãƒ¼ã‚ºã®æ ¹æ‹ 
- ç«¶åˆåˆ†æ
- è²©å£²è¨ˆç”»ã®å¦¥å½“æ€§

#### **å®Ÿç¾å¯èƒ½æ€§ã®è¨¼æ˜**
- æŠ€è¡“çš„å®Ÿç¾å¯èƒ½æ€§
- äººçš„ä½“åˆ¶ã®æ•´å‚™
- è³‡é‡‘è¨ˆç”»ã®ç¢ºå®Ÿæ€§

### ğŸ’¡ æ¡æŠç‡å‘ä¸Šã®ã‚³ãƒ„

1. **æ—©æœŸæº–å‚™**: å…¬å‹Ÿé–‹å§‹å‰ã‹ã‚‰æº–å‚™é–‹å§‹
2. **å°‚é–€å®¶æ´»ç”¨**: èªå®šæ”¯æ´æ©Ÿé–¢ã¨ã®é€£æº
3. **å…·ä½“æ€§é‡è¦–**: æ›–æ˜§ãªè¡¨ç¾ã‚’é¿ã‘ã‚‹
4. **æ•°å€¤æ ¹æ‹ **: åŠ¹æœã‚’å®šé‡çš„ã«èª¬æ˜

### ğŸ“ ã‚µãƒãƒ¼ãƒˆä½“åˆ¶

- **èªå®šæ”¯æ´æ©Ÿé–¢**: å•†å·¥ä¼šè­°æ‰€ã€ä¸­å°ä¼æ¥­è¨ºæ–­å£«ç­‰
- **åœ°åŸŸäº‹å‹™å±€**: å„éƒ½é“åºœçœŒã®ç›¸è«‡çª“å£
- **å°‚é–€å®¶æ´¾é£**: ç”³è«‹æ›¸ä½œæˆæ”¯æ´

ã”è³ªå•ã‚„ã‚ˆã‚Šè©³ç´°ãªç›¸è«‡ã«ã¤ã„ã¦ã¯ã€ãŠæ°—è»½ã«ãŠå°‹ã­ãã ã•ã„ï¼""",
                'confidence_score': 0.95,
                'model_used': 'context-monozukuri-application',
                'recommended_subsidies': []
            }
        else:
            return {
                'answer': """## ğŸ­ ã‚‚ã®ã¥ãã‚Šè£œåŠ©é‡‘ã«ã¤ã„ã¦

**æ­£å¼åç§°**: ã‚‚ã®ã¥ãã‚Šãƒ»å•†æ¥­ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ç”Ÿç”£æ€§å‘ä¸Šä¿ƒé€²è£œåŠ©é‡‘

### ğŸ“Š è£œåŠ©é‡‘æ¦‚è¦
- **è£œåŠ©ä¸Šé™é¡**: 1,250ä¸‡å††ï¼ˆãƒ‡ã‚¸ã‚¿ãƒ«æ ï¼‰
- **è£œåŠ©ç‡**: 1/2ä»¥å†…ï¼ˆå°è¦æ¨¡äº‹æ¥­è€…ã¯2/3ï¼‰
- **å¯¾è±¡**: é©æ–°çš„ãªè¨­å‚™æŠ•è³‡ãƒ»ã‚µãƒ¼ãƒ“ã‚¹é–‹ç™º
- **ç”³è«‹æ™‚æœŸ**: å¹´2-3å›ç¨‹åº¦

### ğŸ¯ å¯¾è±¡ã¨ãªã‚‹äº‹æ¥­

#### **é©æ–°çš„ã‚µãƒ¼ãƒ“ã‚¹é–‹ç™ºãƒ»è©¦ä½œå“é–‹ç™º**
- æ–°è£½å“ãƒ»æ–°ã‚µãƒ¼ãƒ“ã‚¹ã®é–‹ç™º
- æ—¢å­˜ã‚µãƒ¼ãƒ“ã‚¹ã®é©æ–°çš„æ”¹å–„

#### **è¨­å‚™æŠ•è³‡**
- ç”Ÿç”£æ€§å‘ä¸Šè¨­å‚™ã®å°å…¥
- IoTãƒ»AIç­‰ã®å…ˆé€²æŠ€è¡“æ´»ç”¨
- çœã‚¨ãƒãƒ»ç’°å¢ƒé…æ…®å‹è¨­å‚™

### âœ… ä¸»ãªè¦ä»¶

1. **å¯¾è±¡è€…**: ä¸­å°ä¼æ¥­ãƒ»å°è¦æ¨¡äº‹æ¥­è€…
2. **äº‹æ¥­ç¶™ç¶š**: 3å¹´é–“ã®äº‹æ¥­ç¶™ç¶š
3. **ç”Ÿç”£æ€§å‘ä¸Š**: ä»˜åŠ ä¾¡å€¤é¡å¹´ç‡å¹³å‡3%ä»¥ä¸Šå‘ä¸Š
4. **é©æ–°æ€§**: å¾“æ¥æŠ€è¡“ã¨ã®æ˜ç¢ºãªé•ã„

### ğŸ’° è£œåŠ©å¯¾è±¡çµŒè²»

- **æ©Ÿæ¢°è£…ç½®ãƒ»ã‚·ã‚¹ãƒ†ãƒ æ§‹ç¯‰è²»**
- **æŠ€è¡“å°å…¥è²»**
- **å°‚é–€å®¶çµŒè²»**
- **é‹æ¬è²»**
- **ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹åˆ©ç”¨è²»**

### ğŸš€ æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

- ç”Ÿç”£åŠ¹ç‡ã®å¤§å¹…å‘ä¸Š
- æ–°å¸‚å ´ãƒ»æ–°é¡§å®¢ã®é–‹æ‹“
- ç«¶äº‰åŠ›ã®å¼·åŒ–
- å£²ä¸Šãƒ»åˆ©ç›Šã®æ‹¡å¤§

**ç”³è«‹æ–¹æ³•ã«ã¤ã„ã¦è©³ã—ããŠçŸ¥ã‚Šã«ãªã‚ŠãŸã„å ´åˆã¯ã€Œç”³è«‹æ–¹æ³•ã‚’æ•™ãˆã¦ã€ã¨ãŠèããã ã•ã„ï¼**""",
                'confidence_score': 0.9,
                'model_used': 'context-monozukuri-general',
                'recommended_subsidies': []
            }
    
    # ITå°å…¥è£œåŠ©é‡‘ã®æ¤œå‡ºï¼ˆå¼·åŒ–ç‰ˆï¼‰
    elif any(keyword in message_lower for keyword in ['itå°å…¥', 'itãƒ„ãƒ¼ãƒ«', 'ãƒ‡ã‚¸ã‚¿ãƒ«åŒ–', 'itè£œåŠ©é‡‘', 'itå°å…¥è£œåŠ©é‡‘']):
        print("âœ… ITå°å…¥è£œåŠ©é‡‘ã¨ã—ã¦æ¤œå‡º")
        
        if any(keyword in message_lower for keyword in ['ç”³è«‹æ–¹æ³•', 'ç”³è«‹æ‰‹é †', 'ã‚„ã‚Šæ–¹', 'ç”³è«‹']):
            return {
                'answer': """## ğŸ–¥ï¸ ITå°å…¥è£œåŠ©é‡‘ã®ç”³è«‹æ–¹æ³•

ITå°å…¥è£œåŠ©é‡‘ã®ç”³è«‹æ‰‹é †ã‚’è©³ã—ãã”èª¬æ˜ã„ãŸã—ã¾ã™ã€‚

### ğŸ“‹ åŸºæœ¬æƒ…å ±
- **æ­£å¼åç§°**: ã‚µãƒ¼ãƒ“ã‚¹ç­‰ç”Ÿç”£æ€§å‘ä¸ŠITå°å…¥æ”¯æ´äº‹æ¥­
- **è£œåŠ©ä¸Šé™é¡**: æœ€å¤§450ä¸‡å††
- **è£œåŠ©ç‡**: 1/2ä»¥å†…
- **ç”³è«‹æ™‚æœŸ**: å¹´2å›ç¨‹åº¦ã®å…¬å‹Ÿ

### ğŸ“… è©³ç´°ãªç”³è«‹æ‰‹é †

#### **STEP 1: äº‹å‰æº–å‚™ï¼ˆç”³è«‹ã®1-2ãƒ¶æœˆå‰ï¼‰**

1. **gBizIDãƒ—ãƒ©ã‚¤ãƒ ã®å–å¾—**
   - æ³•äººãƒ»å€‹äººäº‹æ¥­ä¸»å‘ã‘èªè¨¼ã‚·ã‚¹ãƒ†ãƒ 
   - ç”³è«‹ã‹ã‚‰ç™ºè¡Œã¾ã§ç´„2é€±é–“
   - **å¿…é ˆè¦ä»¶ã§ã™**

2. **SECURITY ACTIONã®å®Ÿæ–½**
   - â˜…ä¸€ã¤æ˜Ÿã¾ãŸã¯â˜…â˜…äºŒã¤æ˜Ÿã®å–å¾—
   - æƒ…å ±ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã®å®Ÿæ–½
   - **ç”³è«‹å‰ã«å¿…ãšå®Œäº†ã•ã›ã¦ãã ã•ã„**

3. **ITå°å…¥æ”¯æ´äº‹æ¥­è€…ã®é¸å®š**
   - äº‹å‰ç™»éŒ²ã•ã‚ŒãŸITå°å…¥æ”¯æ´äº‹æ¥­è€…ã‹ã‚‰é¸æŠ
   - ITãƒ„ãƒ¼ãƒ«é¸å®šã®ç›¸è«‡
   - ç”³è«‹æ›¸ä½œæˆæ”¯æ´

#### **STEP 2: ITãƒ„ãƒ¼ãƒ«é¸å®šï¼ˆç”³è«‹ã®1ãƒ¶æœˆå‰ï¼‰**

1. **å¯¾è±¡ITãƒ„ãƒ¼ãƒ«ã®ç¢ºèª**
   - äº‹å‰ç™»éŒ²ã•ã‚ŒãŸITãƒ„ãƒ¼ãƒ«ã‹ã‚‰é¸æŠ
   - è‡ªç¤¾ã®èª²é¡Œè§£æ±ºã«é©ã—ãŸãƒ„ãƒ¼ãƒ«é¸å®š
   - è¤‡æ•°ãƒ„ãƒ¼ãƒ«ã®çµ„ã¿åˆã‚ã›ã‚‚å¯èƒ½

2. **è¦‹ç©æ›¸ã®å–å¾—**
   - ITå°å…¥æ”¯æ´äº‹æ¥­è€…ã‹ã‚‰è¦‹ç©æ›¸å–å¾—
   - ãƒ©ã‚¤ã‚»ãƒ³ã‚¹è²»ç”¨ã€å°å…¥è²»ç”¨ã®ç¢ºèª
   - ä¿å®ˆãƒ»ã‚µãƒãƒ¼ãƒˆè²»ç”¨ã®ç®—å‡º

#### **STEP 3: ç”³è«‹æ›¸ä½œæˆ**

1. **äº¤ä»˜ç”³è«‹æ›¸ã®ä½œæˆ**
   - ITå°å…¥æ”¯æ´äº‹æ¥­è€…ã¨å…±åŒä½œæˆ
   - ç¾çŠ¶ã®èª²é¡Œåˆ†æ
   - å°å…¥åŠ¹æœã®èª¬æ˜

2. **å¿…è¦æ›¸é¡ã®æº–å‚™**
   - å±¥æ­´äº‹é …å…¨éƒ¨è¨¼æ˜æ›¸
   - æ±ºç®—æ›¸ã¾ãŸã¯ç¢ºå®šç”³å‘Šæ›¸
   - åŠ´åƒç”Ÿç”£æ€§å‘ä¸Šã«é–¢ã™ã‚‹è³‡æ–™

#### **STEP 4: ç”³è«‹ãƒ»å¯©æŸ»**

1. **é›»å­ç”³è«‹**
   - ç”³è«‹ãƒã‚¤ãƒšãƒ¼ã‚¸ã‹ã‚‰ã®æå‡º
   - ITå°å…¥æ”¯æ´äº‹æ¥­è€…ãŒä»£ç†ç”³è«‹
   - æœŸé™å³å®ˆ

2. **å¯©æŸ»æœŸé–“**
   - ç´„1-2ãƒ¶æœˆ
   - æ›¸é¢å¯©æŸ»ã®ã¿

3. **äº¤ä»˜æ±ºå®šé€šçŸ¥**
   - æ¡æŠãƒ»ä¸æ¡æŠã®é€£çµ¡

#### **STEP 5: ITãƒ„ãƒ¼ãƒ«å°å…¥ãƒ»å®Ÿç¸¾å ±å‘Š**

1. **ITãƒ„ãƒ¼ãƒ«å°å…¥**
   - äº¤ä»˜æ±ºå®šå¾Œã«å¥‘ç´„ãƒ»å°å…¥é–‹å§‹
   - ITå°å…¥æ”¯æ´äº‹æ¥­è€…ã®ã‚µãƒãƒ¼ãƒˆ

2. **å®Ÿç¸¾å ±å‘Š**
   - å°å…¥å®Œäº†å¾Œ30æ—¥ä»¥å†…
   - åŠ¹æœæ¸¬å®šçµæœã®å ±å‘Š

3. **è£œåŠ©é‡‘äº¤ä»˜**
   - å®Ÿç¸¾ç¢ºèªå¾Œã«è£œåŠ©é‡‘æ”¯æ‰•ã„

### âš ï¸ ç”³è«‹æ™‚ã®é‡è¦ãƒã‚¤ãƒ³ãƒˆ

#### **ç”Ÿç”£æ€§å‘ä¸Šã®æ˜ç¢ºåŒ–**
- å…·ä½“çš„ãªæ¥­å‹™åŠ¹ç‡æ”¹å–„åŠ¹æœ
- å®šé‡çš„ãªåŠ¹æœæ¸¬å®šæŒ‡æ¨™
- åŠ´åƒç”Ÿç”£æ€§å‘ä¸Šã®èª¬æ˜

#### **ITå°å…¥æ”¯æ´äº‹æ¥­è€…ã®é¸æŠ**
- å®Ÿç¸¾ã¨å°‚é–€æ€§ã®ç¢ºèª
- ã‚µãƒãƒ¼ãƒˆä½“åˆ¶ã®å……å®Ÿåº¦
- ç¶™ç¶šçš„ãªä¿å®ˆãƒ»é‹ç”¨æ”¯æ´

#### **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã®å®Ÿæ–½**
- SECURITY ACTIONã®å®Œäº†
- æƒ…å ±ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ–¹é‡ã®ç­–å®š
- å¾“æ¥­å“¡ã¸ã®æ•™è‚²ãƒ»ç ”ä¿®

### ğŸ’¡ æ¡æŠç‡å‘ä¸Šã®ã‚³ãƒ„

1. **æ—©æœŸæº–å‚™**: gBizIDã€SECURITY ACTION ã®äº‹å‰å–å¾—
2. **é©åˆ‡ãªãƒ„ãƒ¼ãƒ«é¸æŠ**: è‡ªç¤¾èª²é¡Œã«æœ€é©ãªITãƒ„ãƒ¼ãƒ«é¸å®š
3. **æ˜ç¢ºãªåŠ¹æœèª¬æ˜**: å°å…¥å‰å¾Œã®æ¯”è¼ƒã‚’æ•°å€¤åŒ–
4. **ä¿¡é ¼ã§ãã‚‹ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼**: å®Ÿç¸¾è±Šå¯ŒãªITå°å…¥æ”¯æ´äº‹æ¥­è€…ã¨ã®é€£æº

### ğŸ› ï¸ å¯¾è±¡ITãƒ„ãƒ¼ãƒ«ä¾‹

- **ä¼šè¨ˆã‚½ãƒ•ãƒˆ**: è²¡å‹™ç®¡ç†ã®åŠ¹ç‡åŒ–
- **é¡§å®¢ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ **: å–¶æ¥­æ´»å‹•ã®æœ€é©åŒ–
- **ECã‚µã‚¤ãƒˆ**: ã‚ªãƒ³ãƒ©ã‚¤ãƒ³è²©å£²ã®æ‹¡å……
- **å‹¤æ€ ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ **: åŠ´å‹™ç®¡ç†ã®è‡ªå‹•åŒ–
- **åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ **: åœ¨åº«ã®é©æ­£åŒ–

### ğŸ“ ã‚µãƒãƒ¼ãƒˆçª“å£

- **ITå°å…¥è£œåŠ©é‡‘äº‹å‹™å±€**: å…¨èˆ¬çš„ãªå•ã„åˆã‚ã›
- **ITå°å…¥æ”¯æ´äº‹æ¥­è€…**: å…·ä½“çš„ãªç”³è«‹æ”¯æ´
- **åœ°åŸŸã®å•†å·¥ä¼šè­°æ‰€**: åœ°åŸŸå¯†ç€å‹ã‚µãƒãƒ¼ãƒˆ

ã”ä¸æ˜ãªç‚¹ãŒã‚ã‚Œã°ã€ãŠæ°—è»½ã«ãŠå°‹ã­ãã ã•ã„ï¼""",
                'confidence_score': 0.95,
                'model_used': 'context-it-application',
                'recommended_subsidies': []
            }
        else:
            return {
                'answer': """## ğŸ–¥ï¸ ITå°å…¥è£œåŠ©é‡‘ã«ã¤ã„ã¦

### ğŸ“Š åŸºæœ¬æƒ…å ±
- **è£œåŠ©ä¸Šé™é¡**: æœ€å¤§450ä¸‡å††
- **è£œåŠ©ç‡**: 1/2ä»¥å†…
- **å¯¾è±¡**: ITãƒ„ãƒ¼ãƒ«ãƒ»ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®å°å…¥

### ğŸ“‹ ç”³è«‹è¦ä»¶
1. **gBizIDãƒ—ãƒ©ã‚¤ãƒ **ã®å–å¾—
2. **SECURITY ACTION**ã®å®Ÿæ–½  
3. ITå°å…¥æ”¯æ´äº‹æ¥­è€…ã¨ã®é€£æº

### ğŸ› ï¸ å¯¾è±¡ITãƒ„ãƒ¼ãƒ«
- ä¼šè¨ˆãƒ»è²¡å‹™ãƒ»çµ¦ä¸ã‚½ãƒ•ãƒˆ
- é¡§å®¢ç®¡ç†ãƒ»å–¶æ¥­æ”¯æ´ã‚·ã‚¹ãƒ†ãƒ 
- ECã‚µã‚¤ãƒˆãƒ»ãƒãƒƒãƒˆã‚·ãƒ§ãƒƒãƒ—æ§‹ç¯‰
- å‹¤æ€ ç®¡ç†ãƒ»äººäº‹ã‚·ã‚¹ãƒ†ãƒ 

### ğŸ“ˆ å°å…¥åŠ¹æœ
ãƒ‡ã‚¸ã‚¿ãƒ«åŒ–ã«ã‚ˆã‚Šæ¥­å‹™åŠ¹ç‡ãŒå‘ä¸Šã—ã€å£²ä¸Šã‚¢ãƒƒãƒ—ã‚„åŠ´åƒæ™‚é–“çŸ­ç¸®ãŒæœŸå¾…ã§ãã¾ã™ã€‚

**ç”³è«‹æ–¹æ³•ã«ã¤ã„ã¦è©³ã—ããŠçŸ¥ã‚Šã«ãªã‚ŠãŸã„å ´åˆã¯ã€ŒITå°å…¥è£œåŠ©é‡‘ã®ç”³è«‹æ–¹æ³•ã‚’æ•™ãˆã¦ã€ã¨ãŠèããã ã•ã„ï¼**""",
                'confidence_score': 0.9,
                'model_used': 'context-it-general',
                'recommended_subsidies': []
            }
    
    # å°è¦æ¨¡äº‹æ¥­è€…æŒç¶šåŒ–è£œåŠ©é‡‘ã®æ¤œå‡º
    elif any(keyword in message_lower for keyword in ['å°è¦æ¨¡', 'æŒç¶šåŒ–', 'è²©è·¯é–‹æ‹“', 'å°è¦æ¨¡äº‹æ¥­è€…']):
        print("âœ… å°è¦æ¨¡äº‹æ¥­è€…æŒç¶šåŒ–è£œåŠ©é‡‘ã¨ã—ã¦æ¤œå‡º")
        
        if any(keyword in message_lower for keyword in ['ç”³è«‹æ–¹æ³•', 'ç”³è«‹æ‰‹é †', 'ã‚„ã‚Šæ–¹', 'ç”³è«‹']):
            return {
                'answer': """## ğŸ¢ å°è¦æ¨¡äº‹æ¥­è€…æŒç¶šåŒ–è£œåŠ©é‡‘ã®ç”³è«‹æ–¹æ³•

å°è¦æ¨¡äº‹æ¥­è€…æŒç¶šåŒ–è£œåŠ©é‡‘ã®ç”³è«‹æ‰‹é †ã‚’è©³ã—ãã”èª¬æ˜ã„ãŸã—ã¾ã™ã€‚

### ğŸ“‹ åŸºæœ¬æƒ…å ±
- **æ­£å¼åç§°**: å°è¦æ¨¡äº‹æ¥­è€…æŒç¶šåŒ–è£œåŠ©é‡‘
- **è£œåŠ©ä¸Šé™é¡**: æœ€å¤§200ä¸‡å††ï¼ˆå‰µæ¥­å‹ï¼‰
- **è£œåŠ©ç‡**: 2/3ä»¥å†…
- **ç”³è«‹æ™‚æœŸ**: å¹´4å›ç¨‹åº¦ã®å…¬å‹Ÿ

### ğŸ“… è©³ç´°ãªç”³è«‹æ‰‹é †

#### **STEP 1: äº‹å‰æº–å‚™ï¼ˆç”³è«‹ã®2-3ãƒ¶æœˆå‰ï¼‰**

1. **å°è¦æ¨¡äº‹æ¥­è€…è¦ä»¶ã®ç¢ºèª**
   - è£½é€ æ¥­ï¼šå¾“æ¥­å“¡20äººä»¥ä¸‹
   - å•†æ¥­ãƒ»ã‚µãƒ¼ãƒ“ã‚¹æ¥­ï¼šå¾“æ¥­å“¡5äººä»¥ä¸‹
   - **å¿…é ˆè¦ä»¶ã§ã™**

2. **å•†å·¥ä¼šè­°æ‰€ã¨ã®é€£æº**
   - åœ°åŸŸã®å•†å·¥ä¼šè­°æ‰€ã«ç›¸è«‡äºˆç´„
   - çµŒå–¶è¨ˆç”»ç­–å®šã®æŒ‡å°ä¾é ¼
   - **æ§˜å¼4ï¼ˆç¢ºèªæ›¸ï¼‰ã®å–å¾—ãŒå¿…è¦**

3. **ç¾çŠ¶åˆ†æã®å®Ÿæ–½**
   - è‡ªç¤¾ã®å¼·ã¿ãƒ»å¼±ã¿ã®åˆ†æ
   - å¸‚å ´ç’°å¢ƒãƒ»ç«¶åˆçŠ¶æ³ã®æŠŠæ¡
   - èª²é¡Œãƒ»å•é¡Œç‚¹ã®æ•´ç†

#### **STEP 2: çµŒå–¶è¨ˆç”»ç­–å®šï¼ˆç”³è«‹ã®1-2ãƒ¶æœˆå‰ï¼‰**

1. **çµŒå–¶è¨ˆç”»æ›¸ã®ä½œæˆï¼ˆæ§˜å¼2ï¼‰**
   - ä¼æ¥­æ¦‚è¦ã®è¨˜è¼‰
   - é¡§å®¢ãƒ‹ãƒ¼ã‚ºã¨å¸‚å ´ã®å‹•å‘
   - è‡ªç¤¾ã®çµŒå–¶çŠ¶æ³åˆ†æ
   - çµŒå–¶æ–¹é‡ãƒ»ç›®æ¨™ã¨ä»Šå¾Œã®ãƒ—ãƒ©ãƒ³

2. **è£œåŠ©äº‹æ¥­è¨ˆç”»æ›¸ã®ä½œæˆï¼ˆæ§˜å¼3ï¼‰**
   - è£œåŠ©äº‹æ¥­ã®å…·ä½“çš„å†…å®¹
   - è²©è·¯é–‹æ‹“ç­‰ã®å–çµ„å†…å®¹
   - æ¥­å‹™åŠ¹ç‡åŒ–ã®å–çµ„å†…å®¹
   - è£œåŠ©äº‹æ¥­ã®åŠ¹æœ

#### **STEP 3: å¿…è¦æ›¸é¡æº–å‚™**

1. **åŸºæœ¬æ›¸é¡**
   - å°è¦æ¨¡äº‹æ¥­è€…æŒç¶šåŒ–è£œåŠ©é‡‘äº¤ä»˜ç”³è«‹æ›¸ï¼ˆæ§˜å¼1ï¼‰
   - çµŒå–¶è¨ˆç”»æ›¸ï¼ˆæ§˜å¼2ï¼‰
   - è£œåŠ©äº‹æ¥­è¨ˆç”»æ›¸ï¼ˆæ§˜å¼3ï¼‰
   - å•†å·¥ä¼šè­°æ‰€ã®ç¢ºèªæ›¸ï¼ˆæ§˜å¼4ï¼‰

2. **æ·»ä»˜æ›¸é¡**
   - å±¥æ­´äº‹é …å…¨éƒ¨è¨¼æ˜æ›¸
   - æ±ºç®—æ›¸ã¾ãŸã¯ç¢ºå®šç”³å‘Šæ›¸
   - è¦‹ç©æ›¸ï¼ˆè¤‡æ•°æ¥­è€…ã‹ã‚‰æ¨å¥¨ï¼‰
   - ä½ç½®å›³ãƒ»å†™çœŸç­‰

#### **STEP 4: ç”³è«‹ãƒ»å¯©æŸ»**

1. **ç”³è«‹æ›¸æå‡º**
   - é›»å­ç”³è«‹ï¼ˆJã‚°ãƒ©ãƒ³ãƒ„ï¼‰
   - å•†å·¥ä¼šè­°æ‰€çµŒç”±ã§ã®æå‡º
   - æœŸé™å³å®ˆ

2. **å¯©æŸ»æœŸé–“**
   - ç´„2-3ãƒ¶æœˆ
   - æ›¸é¢å¯©æŸ»

3. **æ¡æŠç™ºè¡¨**
   - æ¡æŠãƒ»ä¸æ¡æŠã®é€šçŸ¥

#### **STEP 5: äº‹æ¥­å®Ÿæ–½ãƒ»å ±å‘Š**

1. **è£œåŠ©äº‹æ¥­ã®å®Ÿæ–½**
   - æ¡æŠé€šçŸ¥å¾Œã«äº‹æ¥­é–‹å§‹
   - è¨ˆç”»ã«æ²¿ã£ãŸç€å®Ÿãªå®Ÿè¡Œ

2. **å®Ÿç¸¾å ±å‘Š**
   - äº‹æ¥­å®Œäº†å¾Œ30æ—¥ä»¥å†…
   - å®Ÿç¸¾å ±å‘Šæ›¸ã®æå‡º
   - é ˜åæ›¸ç­‰ã®è¨¼æ†‘æ›¸é¡æ·»ä»˜

3. **è£œåŠ©é‡‘äº¤ä»˜**
   - å®Ÿç¸¾ç¢ºèªå¾Œã«è£œåŠ©é‡‘æ”¯æ‰•ã„

### âš ï¸ ç”³è«‹æ™‚ã®é‡è¦ãƒã‚¤ãƒ³ãƒˆ

#### **å•†å·¥ä¼šè­°æ‰€ã¨ã®å¯†ãªé€£æº**
- çµŒå–¶è¨ˆç”»ç­–å®šã®æ®µéšã‹ã‚‰ç›¸è«‡
- æ§˜å¼4ï¼ˆç¢ºèªæ›¸ï¼‰ã®å–å¾—ã¯å¿…é ˆ
- ç¶™ç¶šçš„ãªçµŒå–¶æ”¯æ´ã®æ´»ç”¨

#### **å…·ä½“çš„ãªè²©è·¯é–‹æ‹“è¨ˆç”»**
- ã‚¿ãƒ¼ã‚²ãƒƒãƒˆé¡§å®¢ã®æ˜ç¢ºåŒ–
- å…·ä½“çš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒæ–¹æ³•
- æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœã®æ•°å€¤åŒ–

#### **å®Ÿç¾å¯èƒ½æ€§ã®é‡è¦–**
- ç„¡ç†ã®ãªã„äº‹æ¥­è¨ˆç”»
- è‡ªç¤¾ã®ä½“åˆ¶ãƒ»èƒ½åŠ›ã«è¦‹åˆã£ãŸå†…å®¹
- ç¶™ç¶šçš„ãªå–çµ„ã¸ã®ç™ºå±•æ€§

### ğŸ’¡ æ¡æŠç‡å‘ä¸Šã®ã‚³ãƒ„

1. **æ—©æœŸã®å•†å·¥ä¼šè­°æ‰€ç›¸è«‡**: è¨ˆç”»ç­–å®šæ®µéšã‹ã‚‰ã‚µãƒãƒ¼ãƒˆæ´»ç”¨
2. **ç¾çŠ¶åˆ†æã®å¾¹åº•**: SWOTåˆ†æç­‰ã«ã‚ˆã‚‹å®¢è¦³çš„ãªç¾çŠ¶æŠŠæ¡
3. **å…·ä½“çš„ãªç›®æ¨™è¨­å®š**: å£²ä¸Šå¢—åŠ ç­‰ã®å®šé‡çš„ãªç›®æ¨™è¨­å®š
4. **ç¶™ç¶šæ€§ã®èª¬æ˜**: è£œåŠ©äº‹æ¥­çµ‚äº†å¾Œã®ç¶™ç¶šãƒ»ç™ºå±•è¨ˆç”»

### ğŸ¯ å¯¾è±¡ã¨ãªã‚‹å–çµ„ä¾‹

#### **è²©è·¯é–‹æ‹“ã®å–çµ„**
- æ–°å•†å“ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ã®PR
- ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ãƒ»ECã‚µã‚¤ãƒˆæ§‹ç¯‰
- å±•ç¤ºä¼šãƒ»å•†è«‡ä¼šã¸ã®å‚åŠ 
- åº—èˆ—æ”¹è£…ãƒ»å•†å“é™³åˆ—ã®å·¥å¤«

#### **æ¥­å‹™åŠ¹ç‡åŒ–ã®å–çµ„**
- å°‚é–€å®¶ã«ã‚ˆã‚‹ã‚³ãƒ³ã‚µãƒ«ãƒ†ã‚£ãƒ³ã‚°
- ITã‚·ã‚¹ãƒ†ãƒ ã®å°å…¥
- æ©Ÿå™¨ãƒ»è¨­å‚™ã®å°å…¥
- å¾“æ¥­å“¡æ•™è‚²ãƒ»ç ”ä¿®

### ğŸ“ ã‚µãƒãƒ¼ãƒˆçª“å£

- **åœ°åŸŸã®å•†å·¥ä¼šè­°æ‰€**: çµŒå–¶è¨ˆç”»ç­–å®šæ”¯æ´
- **äº‹å‹™å±€**: åˆ¶åº¦å…¨èˆ¬ã®å•ã„åˆã‚ã›
- **ä¸­å°ä¼æ¥­è¨ºæ–­å£«ç­‰**: å°‚é–€çš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹

ã”è³ªå•ãŒã‚ã‚Œã°ã€ã¾ãšã¯åœ°åŸŸã®å•†å·¥ä¼šè­°æ‰€ã«ã”ç›¸è«‡ãã ã•ã„ï¼""",
                'confidence_score': 0.95,
                'model_used': 'context-jizokuuka-application',
                'recommended_subsidies': []
            }
        else:
            return {
                'answer': """## ğŸ¢ å°è¦æ¨¡äº‹æ¥­è€…æŒç¶šåŒ–è£œåŠ©é‡‘ã«ã¤ã„ã¦

### ğŸ“Š åŸºæœ¬æƒ…å ±
- **è£œåŠ©ä¸Šé™é¡**: æœ€å¤§200ä¸‡å††ï¼ˆå‰µæ¥­å‹ï¼‰
- **è£œåŠ©ç‡**: 2/3ä»¥å†…
- **å¯¾è±¡**: è²©è·¯é–‹æ‹“ãƒ»ç”Ÿç”£æ€§å‘ä¸Š

### âœ… ä¸»ãªè¦ä»¶
1. å°è¦æ¨¡äº‹æ¥­è€…ã§ã‚ã‚‹ã“ã¨
2. å•†å·¥ä¼šè­°æ‰€ã®æ”¯æ´
3. çµŒå–¶è¨ˆç”»ã®ç­–å®š

### ğŸ¯ å¯¾è±¡äº‹æ¥­
- åºƒå‘Šå®£ä¼ãƒ»PRæ´»å‹•
- å±•ç¤ºä¼šãƒ»å•†è«‡ä¼šå‚åŠ 
- ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ãƒ»ECã‚µã‚¤ãƒˆä½œæˆ
- åº—èˆ—æ”¹è£…ãƒ»è¨­å‚™å°å…¥

### ğŸ“ˆ æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ
è²©è·¯æ‹¡å¤§ã«ã‚ˆã‚Šå£²ä¸Šå‘ä¸Šã¨äº‹æ¥­ã®æŒç¶šçš„ç™ºå±•ãŒè¦‹è¾¼ã‚ã¾ã™ã€‚

**ç”³è«‹æ–¹æ³•ã«ã¤ã„ã¦è©³ã—ããŠçŸ¥ã‚Šã«ãªã‚ŠãŸã„å ´åˆã¯ã€Œå°è¦æ¨¡äº‹æ¥­è€…æŒç¶šåŒ–è£œåŠ©é‡‘ã®ç”³è«‹æ–¹æ³•ã‚’æ•™ãˆã¦ã€ã¨ãŠèããã ã•ã„ï¼**""",
                'confidence_score': 0.9,
                'model_used': 'context-jizokuuka-general',
                'recommended_subsidies': []
            }
    
    # çœåŠ›åŒ–æŠ•è³‡è£œåŠ©é‡‘
    elif any(keyword in message_lower for keyword in ['çœåŠ›åŒ–', 'äººæ‰‹ä¸è¶³', 'è‡ªå‹•åŒ–', 'iot', 'ai', 'ãƒ­ãƒœãƒƒãƒˆ']):
        print("âœ… çœåŠ›åŒ–æŠ•è³‡è£œåŠ©é‡‘ã¨ã—ã¦æ¤œå‡º")
        
        if any(keyword in message_lower for keyword in ['ç”³è«‹æ–¹æ³•', 'ç”³è«‹æ‰‹é †', 'ã‚„ã‚Šæ–¹', 'ç”³è«‹']):
            return {
                'answer': """## ğŸ¤– çœåŠ›åŒ–æŠ•è³‡è£œåŠ©é‡‘ã®ç”³è«‹æ–¹æ³•

çœåŠ›åŒ–æŠ•è³‡è£œåŠ©é‡‘ã®ç”³è«‹æ‰‹é †ã‚’è©³ã—ãã”èª¬æ˜ã„ãŸã—ã¾ã™ã€‚

### ğŸ“‹ åŸºæœ¬æƒ…å ±
- **æ­£å¼åç§°**: ä¸­å°ä¼æ¥­çœåŠ›åŒ–æŠ•è³‡è£œåŠ©é‡‘
- **è£œåŠ©ä¸Šé™é¡**: 1,000ä¸‡å††
- **è£œåŠ©ç‡**: 1/2ä»¥å†…
- **ç”³è«‹æ™‚æœŸ**: å¹´3-4å›ç¨‹åº¦ã®å…¬å‹Ÿ

### ğŸ“… è©³ç´°ãªç”³è«‹æ‰‹é †

#### **STEP 1: äº‹å‰æº–å‚™ï¼ˆç”³è«‹ã®2-3ãƒ¶æœˆå‰ï¼‰**

1. **å¯¾è±¡è¦ä»¶ã®ç¢ºèª**
   - ä¸­å°ä¼æ¥­ãƒ»å°è¦æ¨¡äº‹æ¥­è€…ã®è©²å½“ç¢ºèª
   - äººæ‰‹ä¸è¶³ã®çŠ¶æ³èª¬æ˜
   - çœåŠ›åŒ–ã®å¿…è¦æ€§

2. **çœåŠ›åŒ–è£½å“ã®é¸å®š**
   - äº‹å‰ç™»éŒ²ã•ã‚ŒãŸçœåŠ›åŒ–è£½å“ã‹ã‚‰é¸æŠ
   - IoTãƒ»AIãƒ»ãƒ­ãƒœãƒƒãƒˆç­‰ã®å…ˆé€²æŠ€è¡“
   - è‡ªç¤¾ã®èª²é¡Œè§£æ±ºã«é©ã—ãŸè£½å“é¸å®š

#### **STEP 2: è¨ˆç”»ç­–å®šï¼ˆç”³è«‹ã®1-2ãƒ¶æœˆå‰ï¼‰**

1. **äº‹æ¥­è¨ˆç”»æ›¸ã®ä½œæˆ**
   - ç¾åœ¨ã®äººæ‰‹ä¸è¶³çŠ¶æ³
   - å°å…¥ã™ã‚‹çœåŠ›åŒ–è¨­å‚™ã®è©³ç´°
   - çœåŠ›åŒ–åŠ¹æœã®å®šé‡çš„èª¬æ˜
   - 3å¹´é–“ã®äº‹æ¥­ç¶™ç¶šè¨ˆç”»

2. **åŠ¹æœæ¸¬å®šè¨ˆç”»**
   - å°å…¥å‰å¾Œã®åŠ´åƒæ™‚é–“æ¯”è¼ƒ
   - ç”Ÿç”£æ€§å‘ä¸ŠåŠ¹æœã®ç®—å‡º
   - ä»˜åŠ ä¾¡å€¤é¡å‘ä¸Šã®æ ¹æ‹ 

#### **STEP 3: ç”³è«‹æ›¸ä½œæˆãƒ»æå‡º**

1. **ç”³è«‹æ›¸é¡ä½œæˆ**
   - äº¤ä»˜ç”³è«‹æ›¸
   - äº‹æ¥­è¨ˆç”»æ›¸
   - çµŒè²»å†…è¨³æ›¸
   - è¦‹ç©æ›¸ãƒ»ä»•æ§˜æ›¸

2. **é›»å­ç”³è«‹**
   - å°‚ç”¨ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰ã®æå‡º
   - æœŸé™å³å®ˆ

#### **STEP 4: å¯©æŸ»ãƒ»äº‹æ¥­å®Ÿæ–½**

1. **å¯©æŸ»æœŸé–“**: ç´„1-2ãƒ¶æœˆ
2. **äº‹æ¥­å®Ÿæ–½**: æ¡æŠå¾Œã®è¨­å‚™å°å…¥
3. **å®Ÿç¸¾å ±å‘Š**: åŠ¹æœæ¸¬å®šçµæœã®å ±å‘Š

### âš ï¸ é‡è¦ãƒã‚¤ãƒ³ãƒˆ

- **çœåŠ›åŒ–åŠ¹æœã®å®šé‡åŒ–**ãŒæœ€é‡è¦
- **äººæ‰‹ä¸è¶³ã®æ·±åˆ»ã•**ã‚’å…·ä½“çš„ã«èª¬æ˜
- **ç¶™ç¶šçš„ãªé‹ç”¨è¨ˆç”»**ã®æ˜ç¤º

è©³ã—ã„ç”³è«‹ã‚µãƒãƒ¼ãƒˆã«ã¤ã„ã¦ã‚‚ãŠå°‹ã­ãã ã•ã„ï¼""",
                'confidence_score': 0.95,
                'model_used': 'context-shorikuka-application',
                'recommended_subsidies': []
            }
        else:
            return {
                'answer': """## ğŸ¤– çœåŠ›åŒ–æŠ•è³‡è£œåŠ©é‡‘ã«ã¤ã„ã¦

### ğŸ“Š åŸºæœ¬æƒ…å ±
- **è£œåŠ©ä¸Šé™é¡**: 1,000ä¸‡å††
- **è£œåŠ©ç‡**: 1/2ä»¥å†…
- **å¯¾è±¡**: AIãƒ»IoTãƒ»ãƒ­ãƒœãƒƒãƒˆç­‰ã®çœåŠ›åŒ–è¨­å‚™

### ğŸ”§ å¯¾è±¡è¨­å‚™
- AIãƒ»IoTæ©Ÿå™¨
- ãƒ­ãƒœãƒƒãƒˆãƒ»è‡ªå‹•åŒ–è£…ç½®
- ã‚»ãƒ³ã‚µãƒ¼ãƒ»åˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ 
- çœåŠ›åŒ–ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢

### âœ… ä¸»ãªè¦ä»¶
1. çœåŠ›åŒ–åŠ¹æœã®å®šé‡çš„èª¬æ˜
2. 3å¹´é–“ã®äº‹æ¥­ç¶™ç¶š
3. ä»˜åŠ ä¾¡å€¤é¡ã®å‘ä¸Šè¨ˆç”»

### ğŸ“ˆ æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ
äººæ‰‹ä¸è¶³ã®è§£æ¶ˆã¨åŒæ™‚ã«ã€ä½œæ¥­åŠ¹ç‡ã®å¤§å¹…ãªå‘ä¸ŠãŒè¦‹è¾¼ã‚ã¾ã™ã€‚

**ç”³è«‹æ–¹æ³•ã«ã¤ã„ã¦è©³ã—ããŠçŸ¥ã‚Šã«ãªã‚ŠãŸã„å ´åˆã¯ã€ŒçœåŠ›åŒ–æŠ•è³‡è£œåŠ©é‡‘ã®ç”³è«‹æ–¹æ³•ã‚’æ•™ãˆã¦ã€ã¨ãŠèããã ã•ã„ï¼**""",
                'confidence_score': 0.9,
                'model_used': 'context-shorikuka-general',
                'recommended_subsidies': []
            }
    
    # æ¡æŠç‡ã«é–¢ã™ã‚‹è³ªå•
    elif any(keyword in message_lower for keyword in ['æ¡æŠç‡', 'é€šã‚‹ç¢ºç‡', 'æˆåŠŸç‡', 'å—ã‹ã‚‹']):
        print("âœ… æ¡æŠç‡è³ªå•ã¨ã—ã¦æ¤œå‡º")
        return {
            'answer': """## ğŸ“Š ä¸»è¦è£œåŠ©é‡‘ã®æ¡æŠç‡

### æœ€è¿‘ã®æ¡æŠç‡å®Ÿç¸¾

**ITå°å…¥è£œåŠ©é‡‘**: ç´„70%
- æ¯”è¼ƒçš„æ¡æŠã•ã‚Œã‚„ã™ã„
- è¦ä»¶ã‚’æº€ãŸã›ã°é«˜ç¢ºç‡

**ã‚‚ã®ã¥ãã‚Šè£œåŠ©é‡‘**: ç´„50%
- ç«¶äº‰ãŒæ¿€ã—ã„
- é©æ–°æ€§ãŒé‡è¦

**å°è¦æ¨¡äº‹æ¥­è€…æŒç¶šåŒ–è£œåŠ©é‡‘**: ç´„60%
- å°è¦æ¨¡äº‹æ¥­è€…ã«ã¯æœ‰åˆ©
- åœ°åŸŸæ€§ã‚‚è€ƒæ…®ã•ã‚Œã‚‹

**çœåŠ›åŒ–æŠ•è³‡è£œåŠ©é‡‘**: ç´„55%
- äººæ‰‹ä¸è¶³è§£æ¶ˆã®ãƒ‹ãƒ¼ã‚ºãŒé«˜ã„
- åŠ¹æœã®å®šé‡åŒ–ãŒé‡è¦

### æ¡æŠç‡ã‚’ä¸Šã’ã‚‹ãƒã‚¤ãƒ³ãƒˆ
1. è¦ä»¶ã®å®Œå…¨ãªç†è§£
2. å…·ä½“çš„ãªåŠ¹æœã®èª¬æ˜
3. é©åˆ‡ãªæ”¯æ´æ©Ÿé–¢ã¨ã®é€£æº
4. æ—©æœŸã®æº–å‚™é–‹å§‹

ã‚ˆã‚Šè©³ã—ã„æˆåŠŸã®ã‚³ãƒ„ã«ã¤ã„ã¦ã‚‚ãŠæ•™ãˆã§ãã¾ã™ã€‚""",
            'confidence_score': 0.9,
            'model_used': 'context-adoption-rate',
            'recommended_subsidies': []
        }
    
    # ä¸€èˆ¬çš„ãªè£œåŠ©é‡‘è³ªå•
    else:
        print("âœ… ä¸€èˆ¬çš„ãªè³ªå•ã¨ã—ã¦æ¤œå‡º")
        return {
            'answer': """## ğŸ’¡ è£œåŠ©é‡‘åˆ¶åº¦ã«ã¤ã„ã¦

### ä¸»è¦ãªè£œåŠ©é‡‘åˆ¶åº¦
- **ITå°å…¥è£œåŠ©é‡‘**: ãƒ‡ã‚¸ã‚¿ãƒ«åŒ–æ”¯æ´ï¼ˆæœ€å¤§450ä¸‡å††ï¼‰
- **ã‚‚ã®ã¥ãã‚Šè£œåŠ©é‡‘**: è¨­å‚™æŠ•è³‡æ”¯æ´ï¼ˆæœ€å¤§1,250ä¸‡å††ï¼‰
- **å°è¦æ¨¡äº‹æ¥­è€…æŒç¶šåŒ–è£œåŠ©é‡‘**: è²©è·¯é–‹æ‹“æ”¯æ´ï¼ˆæœ€å¤§200ä¸‡å††ï¼‰
- **çœåŠ›åŒ–æŠ•è³‡è£œåŠ©é‡‘**: äººæ‰‹ä¸è¶³è§£æ¶ˆæ”¯æ´ï¼ˆæœ€å¤§1,000ä¸‡å††ï¼‰

### é¸æŠã®ãƒã‚¤ãƒ³ãƒˆ
1. **äº‹æ¥­è¦æ¨¡**: å°è¦æ¨¡äº‹æ¥­è€… vs ä¸­å°ä¼æ¥­
2. **ç›®çš„**: ãƒ‡ã‚¸ã‚¿ãƒ«åŒ– vs è¨­å‚™æŠ•è³‡ vs è²©è·¯æ‹¡å¤§
3. **æŠ•è³‡é¡**: äºˆç®—ã«å¿œã˜ãŸè£œåŠ©é‡‘é¸æŠ
4. **ç”³è«‹æ™‚æœŸ**: å¹´é–“ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ç¢ºèª

### ğŸ¯ è©³ã—ã„æƒ…å ±ã‚’ãŠçŸ¥ã‚Šã«ãªã‚ŠãŸã„å ´åˆ

å…·ä½“çš„ãªè£œåŠ©é‡‘åã‚’æ•™ãˆã¦ãã ã•ã„ï¼š
- **ã€ŒITå°å…¥è£œåŠ©é‡‘ã«ã¤ã„ã¦æ•™ãˆã¦ã€**
- **ã€Œã‚‚ã®ã¥ãã‚Šè£œåŠ©é‡‘ã«ã¤ã„ã¦æ•™ãˆã¦ã€**
- **ã€Œå°è¦æ¨¡äº‹æ¥­è€…æŒç¶šåŒ–è£œåŠ©é‡‘ã«ã¤ã„ã¦æ•™ãˆã¦ã€**
- **ã€ŒçœåŠ›åŒ–æŠ•è³‡è£œåŠ©é‡‘ã«ã¤ã„ã¦æ•™ãˆã¦ã€**

ã‚ˆã‚Šå…·ä½“çš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’ã”æä¾›ã„ãŸã—ã¾ã™ï¼""",
            'confidence_score': 0.7,
            'model_used': 'context-general',
            'recommended_subsidies': []
        }'''
        
        # æ—¢å­˜ã®é–¢æ•°ã‚’ç½®æ›
        pattern = r'def analyze_message_improved\(message, user_context=None\):.*?(?=def \w+|class \w+|$)'
        
        if re.search(pattern, content, re.DOTALL):
            new_content = re.sub(pattern, new_function, content, flags=re.DOTALL)
            
            with open('advisor/views.py', 'w', encoding='utf-8') as f:
                f.write(new_content)
            
            print("âœ… æ–‡è„ˆç†è§£æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¾ã—ãŸ")
            return True
        else:
            print("âŒ é–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ")
            return False
            
    except Exception as e:
        print("âŒ æ›´æ–°ã‚¨ãƒ©ãƒ¼:", str(e))
        return False

def main():
    """ãƒ¡ã‚¤ãƒ³å®Ÿè¡Œ"""
    print("ğŸ§  æ–‡è„ˆç†è§£æ©Ÿèƒ½ã‚’è¿½åŠ ä¸­...")
    print("=" * 50)
    
    if update_analyze_function_with_context():
        print("âœ… æ–‡è„ˆç†è§£æ©Ÿèƒ½ã®è¿½åŠ å®Œäº†ï¼")
        print("\nğŸ“‹ æ”¹å–„å†…å®¹:")
        print("- ã€Œç”³è«‹æ–¹æ³•ã‚’æ•™ãˆã¦ã€ãªã©ã®ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—è³ªå•ã‚’èªè­˜")
        print("- å„è£œåŠ©é‡‘ã®èª¬æ˜æ–‡ã«ã€Œç”³è«‹æ–¹æ³•ã‚’æ•™ãˆã¦ã€ã®æ¡ˆå†…ã‚’è¿½åŠ ")
        print("- ã‚ˆã‚Šæ˜ç¢ºãªæ¡ˆå†…ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º")
        print("\nğŸ§ª ãƒ†ã‚¹ãƒˆæ–¹æ³•:")
        print("1. ã€ŒITå°å…¥è£œåŠ©é‡‘ã«ã¤ã„ã¦æ•™ãˆã¦ã€")
        print("2. ç¶šã‘ã¦ã€Œç”³è«‹æ–¹æ³•ã‚’æ•™ãˆã¦ã€")
        print("3. è©³ç´°ãªç”³è«‹æ‰‹é †ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª")
    else:
        print("âŒ æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")

if __name__ == "__main__":
    main()